---

# LDAP configuration
ldap:
  hostname: 'ldap.{{ network.domain }}'
  organization:
    domain: '{{ network.domain }}'
    base: 'dc={{ network.domain | regex_replace("\.", ",dc=") }}'
  users:
    dn: 'ou=users,dc={{ network.domain | regex_replace("\.", ",dc=") }}'
  groups:
    dn: 'ou=groups,dc={{ network.domain | regex_replace("\.", ",dc=") }}'
  manager:
    uid: manager
    dn: 'cn=manager account, ou=users, dc={{ network.domain | regex_replace("\.", ",dc=") }}'
  readonly:
    uid: readonly
    dn: 'cn=readonly account, ou=users, dc={{ network.domain | regex_replace("\.", ",dc=") }}'
  admin:
    dn: 'cn=admin,dc={{ network.domain | regex_replace("\.", ",dc=") }}'
    desc: administrator account
  postmaster:
    uid: postmaster
    dn: 'cn=postmaster account, ou=users, dc={{ network.domain | regex_replace("\.", ",dc=") }}'
    # See https://www.ietf.org/rfc/rfc2142.txt
    mailAliases:
      - 'abuse@{{ network.domain }}'
      - 'noc@{{ network.domain }}'
      - 'security@{{ network.domain }}'
      - 'mailer-daemon@{{ network.domain }}'
      - 'webmaster@{{ network.domain }}'
      - 'hostmaster@{{ network.domain }}'
      - 'admin@{{ network.domain }}'
      - 'root@{{ network.domain }}'


sieve:
  global_scripts:
    - before-global.sieve
    - draft-rules.sieve
    - duplicate-checks.sieve
    - report-ham.sieve
    - report-spam.sieve
    - sent-checks.sieve
    - tags-important.sieve

# Default dovecot packages to install
dovecot:
  packages:
    - dovecot-core
    - dovecot-imapd
    - dovecot-ldap
    - dovecot-lmtpd
    - dovecot-managesieved
    - dovecot-pop3d
    - dovecot-sieve
  fts_packages:
    - catdoc
    - docx2txt
    - dovecot-fts-xapian
    - gzip
    - odt2txt
    - p7zip-full
    - poppler-utils
    - tnef
    - unrar-free
    - unrtf
    - unzip
    - xlsx2csv
  access_check_packages:
    - curl
    - grepcidr
    - sqlite3
  settings:
    mail_max_userip_connections: 64
    lda_mailbox_autocreate: no
    lda_mailbox_autosubscribe: no
  # Authorized characters for the username
  username_chars: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890.-_@
  # Since Debian Buster, these profiles are included in apparmor-proofiles-extra
  apparmor_system_profiles:
    - usr.lib.dovecot.anvil
    - usr.lib.dovecot.auth
    - usr.lib.dovecot.config
    - usr.lib.dovecot.deliver
    - usr.lib.dovecot.dict
    - usr.lib.dovecot.dovecot-auth
    - usr.lib.dovecot.dovecot-lda
    - usr.lib.dovecot.imap
    - usr.lib.dovecot.imap-login
    - usr.lib.dovecot.lmtp
    - usr.lib.dovecot.log
    - usr.lib.dovecot.managesieve
    - usr.lib.dovecot.managesieve-login
    - usr.lib.dovecot.pop3
    - usr.lib.dovecot.pop3-login
    - usr.lib.dovecot.ssl-params
    - usr.sbin.dovecot
